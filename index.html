<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GOV.BR â€” Quiz de AptidÃ£o CNH</title>
<style>
:root{
  --gov-blue:#002b7f;
  --gov-yellow:#ffcb05;
  --bg:#f3f5f7;
  --card:#ffffff;
  --muted:#6b7280;
  --accent:#063970;
  --success:#1aa05b;
  --danger:#d64545;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: Inter, "Helvetica Neue", Arial, sans-serif;
  background: linear-gradient(180deg,var(--bg),#eef3fb 200px);
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding:28px 12px;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  color:#0b1220;
}
.app{
  width:100%;
  max-width:520px;
  position:relative;
  transform-origin:top center;
}
.header{
  background:linear-gradient(90deg,var(--gov-blue),#003f9a);
  color:#fff;
  padding:18px 20px;
  border-radius:14px;
  display:flex;
  gap:12px;
  align-items:center;
  box-shadow:0 8px 30px rgba(2,24,71,0.12);
}
.header .brand{
  display:flex;
  gap:12px;
  align-items:center;
}
.logo-gov{
  width:48px;
  height:48px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  background:rgba(255,255,255,0.08);
  border-radius:8px;
}
.header h1{
  font-size:18px;
  margin:0;
  letter-spacing:0.2px;
  font-weight:700;
}
.header p{
  margin:0;
  font-size:12px;
  opacity:0.95;
  color:rgba(255,255,255,0.9);
}
.card{
  margin-top:-28px;
  background:var(--card);
  border-radius:14px;
  padding:20px;
  box-shadow:0 12px 40px rgba(15,23,42,0.08);
  overflow:hidden;
}
.top-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  margin-bottom:14px;
}
.counter{
  display:flex;
  gap:8px;
  align-items:center;
}
.counter .num{
  background:linear-gradient(180deg,var(--gov-yellow),#f6b800);
  color:#012047;
  padding:6px 10px;
  border-radius:10px;
  font-weight:700;
  box-shadow:0 6px 18px rgba(3,35,102,0.12);
  font-size:13px;
}
.status{
  font-size:13px;
  color:var(--muted);
}
.progress-wrap{
  height:12px;
  background:#e6eefb;
  border-radius:999px;
  overflow:hidden;
  position:relative;
  margin-bottom:18px;
}
.progress{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--gov-yellow),#ffd84d);
  transition:width 450ms cubic-bezier(.2,.9,.3,1);
  box-shadow:inset 0 -4px 12px rgba(0,0,0,0.06);
}
.question{
  display:flex;
  gap:12px;
  align-items:flex-start;
}
.qicon{
  width:56px;
  height:56px;
  background:linear-gradient(180deg,#eaf6ff,#f7fbff);
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  box-shadow:0 6px 18px rgba(2,35,94,0.06);
}
.qcontent{flex:1}
.title{
  font-size:18px;
  font-weight:700;
  color:var(--accent);
  margin-bottom:8px;
}
.hint{
  font-size:13px;
  color:var(--muted);
  margin-bottom:14px;
}
.options{
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
  margin-bottom:16px;
}
.option{
  display:flex;
  gap:12px;
  align-items:center;
  padding:12px;
  border-radius:10px;
  background:#f6f9fe;
  cursor:pointer;
  border:2px solid transparent;
  transition:transform 180ms ease, box-shadow 180ms ease, border-color 160ms ease;
  user-select:none;
}
.option:hover{transform:translateY(-4px); box-shadow:0 10px 28px rgba(2,30,90,0.06)}
.option .thumb{
  width:48px;
  height:48px;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
}
.option .text{font-size:15px; font-weight:600; color:#0b1220}
.option.selected{border-color:rgba(2,43,127,0.12); background:linear-gradient(180deg,#eef6ff,#f5f9ff)}
.controls{
  display:flex;
  gap:12px;
  align-items:center;
  margin-top:8px;
}
.btn{
  flex:1;
  padding:12px 14px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:700;
  font-size:15px;
  color:#fff;
  background:var(--gov-blue);
  transition:transform 140ms ease, box-shadow 140ms ease, opacity 120ms ease;
  box-shadow:0 10px 30px rgba(2,35,94,0.08);
}
.btn:active{transform:translateY(2px)}
.btn.secondary{
  background:#eef3fb;
  color:var(--accent);
  font-weight:700;
  box-shadow:none;
}
.timer{
  min-width:110px;
  text-align:right;
  font-size:14px;
  color:var(--muted);
}
.small{
  font-size:13px;color:var(--muted)
}
.footer-note{
  margin-top:14px;
  font-size:13px;
  color:var(--muted);
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}
.result{
  padding:28px;
  text-align:center;
}
.result h2{
  margin:6px 0 6px;
  color:var(--gov-blue);
  font-size:24px;
}
.result p{color:var(--muted); margin:6px 0 18px; font-size:16px}
.badge{
  display:inline-block;
  background:linear-gradient(180deg,var(--gov-yellow),#ffb800);
  color:#012047;
  padding:8px 14px;
  font-weight:800;
  border-radius:20px;
  font-size:15px;
  box-shadow:0 10px 30px rgba(0,0,0,0.08);
}
.score{
  font-size:48px;
  margin-top:12px;
  font-weight:900;
  color:var(--accent);
  letter-spacing:1px;
}
.pass{color:var(--success)}
.fail{color:var(--danger)}
@keyframes pulse {
  0%{transform:scale(1)}
  50%{transform:scale(1.02)}
  100%{transform:scale(1)}
}
.toast{
  position:fixed;
  right:20px;
  bottom:20px;
  background:#063970;
  color:#fff;
  padding:12px 16px;
  border-radius:10px;
  box-shadow:0 10px 30px rgba(2,35,94,0.18);
  font-weight:700;
  display:none;
}
.confetti-piece{
  position:fixed;
  pointer-events:none;
  width:10px;height:14px;
  opacity:0.95;
  transform-origin:center;
  z-index:9999;
}

/* Processing screen */
.processing {
  max-width:520px;
  margin:18px auto 0;
  background:linear-gradient(180deg,#fcfdff,#f6fbff);
  border-radius:14px;
  padding:22px;
  box-shadow:0 12px 40px rgba(15,23,42,0.06);
  text-align:center;
}
.loading-bar {
  width:100%;
  background:#e9f1ff;
  height:12px;
  border-radius:10px;
  overflow:hidden;
  margin:18px auto;
}
.loading-bar-inner{
  width:0%;
  height:100%;
  background:linear-gradient(90deg,var(--gov-yellow),#ffd84d);
  transition:width 600ms ease;
}
.loading-dots{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-top:14px;
}
.loading-dot{
  width:12px;height:12px;border-radius:50%;background:#0d6efd;animation:jump 1.1s infinite;
}
.loading-dot:nth-child(2){animation-delay:0.12s}
.loading-dot:nth-child(3){animation-delay:0.24s}
@keyframes jump{
  0%{transform:translateY(0)}
  50%{transform:translateY(-8px)}
  100%{transform:translateY(0)}
}
</style>
</head>
<body>
<div class="app" id="app">
  <div class="header">
    <div class="brand">
      <div class="logo-gov" aria-hidden="true">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="24" height="24" rx="4" fill="white"/>
          <path d="M3 9.5C3 7.01472 5.01472 5 7.5 5H16.5C18.9853 5 21 7.01472 21 9.5V14.5C21 16.9853 18.9853 19 16.5 19H7.5C5.01472 19 3 16.9853 3 14.5V9.5Z" fill="#002b7f"/>
          <circle cx="12" cy="12" r="2.6" fill="#ffcb05"/>
        </svg>
      </div>
      <div>
        <h1>GOV.BR â€” AvaliaÃ§Ã£o CNH</h1>
        <p class="small">Teste rÃ¡pido para verificar sua aptidÃ£o teÃ³rica para a CNH</p>
      </div>
    </div>
    <div style="margin-left:auto;text-align:right">
      <div class="small">Progresso geral</div>
      <div style="width:160px;margin-top:6px">
        <div style="background:#eef6ff;border-radius:8px;padding:4px">
          <div id="miniProgress" style="height:8px;background:linear-gradient(90deg,var(--gov-yellow),#ffd84d);width:0%;border-radius:6px;transition:width 350ms"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="card" id="card">
    <div class="top-row">
      <div class="counter">
        <div class="num" id="qnum">1/30</div>
        <div class="status" id="qtitle">Pergunta</div>
      </div>
      <div class="timer" id="timer">Tempo: <strong id="timeLeft">20</strong>s</div>
    </div>

    <div class="progress-wrap" aria-hidden="true">
      <div class="progress" id="progressBar"></div>
    </div>

    <div class="question" id="questionBlock">
      <div class="qicon" id="qicon">ğŸš¦</div>
      <div class="qcontent">
        <div class="title" id="questionText">Carregando...</div>
        <div class="hint" id="hint">Escolha a alternativa correta</div>
      </div>
    </div>

    <div class="options" id="options"></div>

    <div class="controls">
      <button class="btn secondary" id="btnSkip">Pular</button>
      <button class="btn" id="btnNext" disabled>Continuar</button>
    </div>

    <div class="footer-note">
      <div class="small">Todas as perguntas sÃ£o orientativas e seguem o conteÃºdo do exame teÃ³rico.</div>
      <div class="small">PontuaÃ§Ã£o mÃ­nima para aptidÃ£o: <strong id="minScoreLabel">21/30</strong></div>
    </div>
  </div>

  <div class="card" id="resultCard" style="display:none"></div>
</div>

<!-- Processing container (hidden by default) -->
<div id="processingContainer" class="processing" style="display:none">
  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Gov.br_logo.svg/512px-Gov.br_logo.svg.png"
       style="width:140px;margin-bottom:12px">
  <h3 style="margin:8px 0 6px;color:#063970;font-size:20px">Processando suas respostas</h3>
  <p style="color:#555;margin:0 0 12px">Verificando conformidade com os critÃ©rios do GOV.BR</p>
  <div class="loading-bar"><div id="loadingInner" class="loading-bar-inner"></div></div>
  <div class="loading-dots">
    <div class="loading-dot"></div>
    <div class="loading-dot"></div>
    <div class="loading-dot"></div>
  </div>
  <p style="color:#777;margin-top:12px;font-size:13px">Isso pode levar alguns segundos â€” anÃ¡lise automÃ¡tica em andamento</p>
</div>

<div class="toast" id="toast">Resposta registrada</div>

<audio id="soundSelect">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
</audio>
<audio id="soundCorrect">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-successful-interface-2014.mp3" type="audio/mpeg">
</audio>
<audio id="soundWrong">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-quick-failure-fanfare-2873.mp3" type="audio/mpeg">
</audio>

<script>
/* ====== 30 perguntas (teÃ³ricas + psicotÃ©cnico) ====== */
const questions = [
  { q:"O que significa a placa de â€˜PAREâ€™?", o:[{t:"Pare obrigatoriamente", i:"âœ‹"},{t:"Prossiga com atenÃ§Ã£o", i:"â¡ï¸"},{t:"Reduza a velocidade", i:"ğŸ¢"}], c:0 },
  { q:"Qual Ã© o limite mÃ¡ximo em vias urbanas, quando nÃ£o sinalizado?", o:[{t:"40 km/h", i:"40"},{t:"50 km/h", i:"50"},{t:"60 km/h", i:"60"}], c:1 },
  { q:"Ao se aproximar de faixa de pedestres, o condutor deve:", o:[{t:"Acelerar para atravessar rÃ¡pido", i:"ğŸï¸"},{t:"Dar preferÃªncia ao pedestre", i:"ğŸš¶"},{t:"Buzinar e seguir", i:"ğŸ“¢"}], c:1 },
  { q:"Dirigir alcoolizado Ã© permitido quando:", o:[{t:"Abaixo de 0.3% de Ã¡lcool", i:"âŒ"},{t:"Nunca", i:"â›”"},{t:"Se tiver dormido antes", i:"ğŸ’¤"}], c:1 },
  { q:"Qual documento Ã© obrigatÃ³rio portar ao dirigir?", o:[{t:"CNH", i:"ğŸªª"},{t:"Comprovante de endereÃ§o", i:"ğŸ "},{t:"TÃ­tulo de eleitor", i:"ğŸ—³ï¸"}], c:0 },
  { q:"O que significa semÃ¡foro piscando amarelo?", o:[{t:"AtenÃ§Ã£o e reduzir a velocidade", i:"âš ï¸"},{t:"Parar imediatamente", i:"âœ‹"},{t:"Siga normalmente", i:"âœ…"}], c:0 },
  { q:"Ultrapassagem deve ser realizada pela:", o:[{t:"Direita", i:"â¡ï¸"},{t:"Esquerda", i:"â¬…ï¸"},{t:"Acostamento", i:"ğŸ›£ï¸"}], c:1 },
  { q:"Cinto de seguranÃ§a Ã© obrigatÃ³rio para:", o:[{t:"Apenas motorista", i:"ğŸ‘¤"},{t:"Todos os ocupantes", i:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"},{t:"Apenas passageiros da frente", i:"ğŸ‘¥"}], c:1 },
  { q:"O que fazer em caso de aquaplanagem (perda de aderÃªncia na Ã¡gua)?", o:[{t:"Frear bruscamente", i:"ğŸ›‘"},{t:"Segurar firme o volante e reduzir gradual", i:"ğŸ•¹ï¸"},{t:"Acelerar", i:"ğŸ"}], c:1 },
  { q:"Ao alterar de faixa, o condutor deve:", o:[{t:"Sinalizar e verificar espelhos", i:"ğŸ”"},{t:"Acelerar e entrar", i:"âš¡"},{t:"Buzinar e empurrar", i:"ğŸ“¢"}], c:0 },
  { q:"Qual atitude em rotatÃ³ria Ã© correta?", o:[{t:"Quem jÃ¡ estÃ¡ dentro tem preferÃªncia", i:"ğŸ”„"},{t:"Quem entra tem preferÃªncia", i:"â¡ï¸"},{t:"Parar sempre", i:"âœ‹"}], c:0 },
  { q:"Quem pode transportar crianÃ§as no banco dianteiro?", o:[{t:"Sempre permitido", i:"ğŸš—"},{t:"Somente com dispositivo de retenÃ§Ã£o adequado quando permitido", i:"ğŸ‘¶"},{t:"Nunca", i:"âŒ"}], c:1 },
  { q:"Se um pedestre estiver atravessando fora da faixa, o condutor deve:", o:[{t:"Acelerar para passar antes", i:"ğŸƒâ€â™‚ï¸"},{t:"Reduzir e evitar risco", i:"ğŸ›‘"},{t:"Ignorar", i:"ğŸ™ˆ"}], c:1 },
  { q:"Qual Ã© a medida imediata ao avistar veÃ­culo com prioridade (ambulÃ¢ncia)?", o:[{t:"Parar e deixar passar", i:"ğŸš‘"},{t:"Acelerar e avanÃ§ar", i:"ğŸï¸"},{t:"Buzinar para alertar", i:"ğŸ“¢"}], c:0 },
  { q:"A CNH definitiva Ã© concedida apÃ³s:", o:[{t:"PerÃ­odo probatÃ³rio de 12 meses sem infraÃ§Ãµes graves", i:"ğŸ“…"},{t:"3 meses de habilitaÃ§Ã£o", i:"90"},{t:"Apenas apÃ³s prova prÃ¡tica", i:"ğŸ› ï¸"}], c:0 },

  /* psicotÃ©cnico e situacionais */
  { q:"Em situaÃ§Ã£o de conflito no trÃ¢nsito, a melhor atitude Ã©:", o:[{t:"Manter a calma e evitar confronto", i:"ğŸ˜Œ"},{t:"Revidar imediatamente", i:"ğŸ˜¡"},{t:"Perseguir o outro veÃ­culo", i:"ğŸ"}], c:0 },
  { q:"Se sentir sono intenso dirigindo, vocÃª deve:", o:[{t:"Parar em local seguro e descansar", i:"ğŸ›‘"},{t:"Tomar cafÃ© e seguir", i:"â˜•"},{t:"Mandar mensagem e continuar", i:"ğŸ“±"}], c:0 },
  { q:"Ao ouvir sirene de socorro, o condutor deve:", o:[{t:"Dar passagem com seguranÃ§a", i:"ğŸš‘"},{t:"Ignorar e seguir", i:"â¡ï¸"},{t:"Buzinar para acelerar", i:"ğŸ“¢"}], c:0 },
  { q:"Se outro motorista demonstra comportamento agressivo, o correto Ã©:", o:[{t:"Evitar confronto e manter distÃ¢ncia", i:"â†”ï¸"},{t:"Responder agressivamente", i:"ğŸ”¥"},{t:"ForÃ§ar passagem", i:"ğŸš—"}], c:0 },
  { q:"Como agir ao perceber falha nos freios?", o:[{t:"Acionar a luz de emergÃªncia e buscar local seguro", i:"âš ï¸"},{t:"Desligar o carro na pista", i:"â›”"},{t:"Continuar dirigindo normalmente", i:"âœ…"}], c:0 },
  { q:"O que indica falta de atenÃ§Ã£o ao volante?", o:[{t:"DesatenÃ§Ã£o, distraÃ§Ãµes frequentes", i:"ğŸ“µ"},{t:"ConcentraÃ§Ã£o mÃ¡xima", i:"ğŸ¯"},{t:"Controle perfeito", i:"ğŸ‘Œ"}], c:0 },
  { q:"Se perder a noÃ§Ã£o do tempo e dirigir por longas horas sem parar:", o:[{t:"Planejar paradas e descansar", i:"ğŸ•’"},{t:"Ignorar o cansaÃ§o", i:"ğŸ’ª"},{t:"Acelerar para chegar logo", i:"ğŸ"}], c:0 },
  { q:"Ao conduzir veÃ­culo com chuva intensa, o que Ã© prioritÃ¡rio?", o:[{t:"Reduzir a velocidade e aumentar distÃ¢ncia", i:"ğŸŒ§ï¸"},{t:"Aumentar velocidade para vencer Ã¡gua", i:"ğŸ’¨"},{t:"Parar no meio da via", i:"ğŸ›‘"}], c:0 },
  { q:"Se um pedestre se aproxima de forma inesperada na via, vocÃª deve:", o:[{t:"Reduzir e evitar qualquer risco", i:"ğŸ§"},{t:"Acelerar para passar antes", i:"ğŸï¸"},{t:"Buzinar e seguir", i:"ğŸ“¢"}], c:0 },
  { q:"Ao observar um veÃ­culo mal estacionado obstruindo, a atitude Ã©:", o:[{t:"Avisar Ã s autoridades competentes", i:"ğŸš“"},{t:"Empurrar para abrir passagem", i:"âœŠ"},{t:"Colocar em risco para contornar", i:"âš ï¸"}], c:0 },
  { q:"A atenÃ§Ã£o dividida ao volante causa:", o:[{t:"Aumento significativo do risco de acidente", i:"âš ï¸"},{t:"Melhora na performance", i:"ğŸ¯"},{t:"Nenhuma alteraÃ§Ã£o", i:"ğŸ‘Œ"}], c:0 },
  { q:"Se o trÃ¢nsito estiver muito estressante, o condutor deveria:", o:[{t:"Reduzir exposiÃ§Ã£o e procurar rotas alternativas", i:"ğŸ—ºï¸"},{t:"Insistir em caminhos arriscados", i:"ğŸ"},{t:"Responder agressivamente", i:"ğŸ˜¡"}], c:0 },
  { q:"Qual comportamento demonstra responsabilidade no trÃ¢nsito?", o:[{t:"Respeitar regras e pedestres", i:"âœ…"},{t:"ForÃ§ar passagem", i:"âŒ"},{t:"Ignorar sinalizaÃ§Ã£o", i:"ğŸš«"}], c:0 },
  { q:"Se encontrar dificuldades emocionais ou estresse, o ideal ao dirigir Ã©:", o:[{t:"Evitar dirigir atÃ© estar bem", i:"ğŸ§˜"},{t:"ForÃ§ar a dirigir", i:"ğŸƒ"},{t:"Tomar remÃ©dios sem orientaÃ§Ã£o", i:"ğŸ’Š"}], c:0 },
  { q:"Ao se aproximar de escola com crianÃ§as, o condutor deve:", o:[{t:"Reduzir a velocidade e redobrar atenÃ§Ã£o", i:"ğŸ«"},{t:"Acelerar para passar rÃ¡pido", i:"ğŸï¸"},{t:"Buzinar para as crianÃ§as saÃ­rem", i:"ğŸ“¢"}], c:0 },
  { q:"Se perceber que outro motorista estÃ¡ alcoolizado, sua atitude Ã©:", o:[{t:"Afastar-se e notificar autoridades", i:"ğŸ“"},{t:"Provocar confronto", i:"ğŸ˜ "},{t:"Seguir o motorista", i:"ğŸš—"}], c:0 },
  { q:"A paciÃªncia no trÃ¢nsito contribui para:", o:[{t:"Reduzir acidentes", i:"ğŸ•Šï¸"},{t:"Aumentar agressividade", i:"ğŸ”¥"},{t:"Mais infraÃ§Ãµes", i:"ğŸš«"}], c:0 },
  { q:"Ao identificar comportamento perigoso em si mesmo, o correto Ã©:", o:[{t:"Buscar orientaÃ§Ã£o e nÃ£o dirigir atÃ© melhorar", i:"ğŸ©º"},{t:"Ignorar e continuar", i:"â¡ï¸"},{t:"Confiar que vai passar sozinho", i:"â³"}], c:0 }
];

let index = 0;
let score = 0;
let canSelect = true;
let selectedOption = null;
let timerInterval = null;
let timePerQuestion = 20;
const minScore = 21; // 21/30 (70%) - padrÃ£o de aprovaÃ§Ã£o
document.getElementById('minScoreLabel')?.innerText && (document.getElementById('minScoreLabel').innerText = `${minScore}/30`);

const qnum = document.getElementById('qnum');
const qtitle = document.getElementById('qtitle');
const questionText = document.getElementById('questionText');
const hint = document.getElementById('hint');
const qicon = document.getElementById('qicon');
const optionsWrap = document.getElementById('options');
const btnNext = document.getElementById('btnNext');
const btnSkip = document.getElementById('btnSkip');
const progressBar = document.getElementById('progressBar');
const miniProgress = document.getElementById('miniProgress');
const timeLeft = document.getElementById('timeLeft');
const toast = document.getElementById('toast');
const card = document.getElementById('card');
const resultCard = document.getElementById('resultCard');
const processingContainer = document.getElementById('processingContainer');

const soundSelect = document.getElementById('soundSelect');
const soundCorrect = document.getElementById('soundCorrect');
const soundWrong = document.getElementById('soundWrong');

function startTimer(){
  clearInterval(timerInterval);
  let t = timePerQuestion;
  timeLeft.innerText = t;
  timerInterval = setInterval(()=>{
    t--;
    timeLeft.innerText = t;
    if(t<=0){ clearInterval(timerInterval); timeoutAnswer(); }
  },1000);
}

function timeoutAnswer(){
  canSelect=false;
  highlightCorrect();
  showToast('Tempo esgotado');
  setTimeout(()=>{ nextQuestion(); },900);
}

function render(){
  const item = questions[index];
  qnum.innerText = `${index+1}/${questions.length}`;
  qtitle.innerText = `Pergunta ${index+1}`;
  questionText.innerText = item.q;
  hint.innerText = 'Selecione a alternativa correta';
  progressBar.style.width = `${(index / questions.length) * 100}%`;
  miniProgress.style.width = `${(index / questions.length) * 100}%`;
  qicon.innerText = getIconForQuestion(index);
  optionsWrap.innerHTML = '';
  item.o.forEach((opt,i)=>{
    const div = document.createElement('div');
    div.className = 'option';
    div.tabIndex = 0;
    div.innerHTML = `<div class="thumb">${opt.i}</div><div class="text">${opt.t}</div>`;
    div.onclick = ()=>choose(i,div);
    div.onkeypress = (e)=>{ if(e.key==='Enter') choose(i,div); }
    optionsWrap.appendChild(div);
  });
  canSelect=true;
  selectedOption=null;
  btnNext.disabled=true;
  startTimer();
}

function choose(i,el){
  if(!canSelect) return;
  soundSelect.currentTime=0; soundSelect.play();
  document.querySelectorAll('.option').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');
  selectedOption=i;
  btnNext.disabled=false;
}

function showToast(txt){
  toast.innerText = txt;
  toast.style.display='block';
  toast.style.opacity='1';
  setTimeout(()=>{ toast.style.opacity='0'; setTimeout(()=>toast.style.display='none',300); },1200);
}

function highlightCorrect(){
  const correctIndex = questions[index].c;
  const opts = document.querySelectorAll('.option');
  opts.forEach((o,idx)=>{
    o.style.pointerEvents='none';
    if(idx===correctIndex){
      o.style.borderColor='rgba(26,160,91,0.14)';
      o.style.boxShadow='0 10px 30px rgba(26,160,91,0.06)';
    } else {
      o.style.opacity='0.7';
    }
  });
}

function nextQuestion(){
  clearInterval(timerInterval);
  if(selectedOption !== null){
    const correct = questions[index].c;
    if(selectedOption===correct){ score++; soundCorrect.currentTime=0; soundCorrect.play(); }
    else{ soundWrong.currentTime=0; soundWrong.play(); }
    highlightCorrect();
  } else {
    soundWrong.currentTime=0; soundWrong.play();
    highlightCorrect();
  }
  canSelect=false;
  setTimeout(()=>{
    index++;
    if(index>=questions.length) return finish();
    render();
  },900);
}

btnNext.addEventListener('click',()=>{
  nextQuestion();
});

btnSkip.addEventListener('click',()=>{
  soundSelect.currentTime=0; soundSelect.play();
  showToast('Pergunta pulada');
  selectedOption=null;
  nextQuestion();
});

function showProcessingAndResult(){
  // hide quiz card, show processing screen, then show result based on score
  card.style.display = 'none';
  processingContainer.style.display = 'block';
  const loadingInner = document.getElementById('loadingInner');
  let progress = 0;
  const steps = [18, 40, 70, 85, 95, 100]; // staged progress
  let stepIndex = 0;
  const interval = setInterval(()=>{
    progress += Math.floor(Math.random()*7)+6; // smooth random increments
    if(progress >= steps[stepIndex]) {
      progress = steps[stepIndex];
      stepIndex = Math.min(stepIndex+1, steps.length-1);
    }
    if(progress > 100) progress = 100;
    loadingInner.style.width = progress + '%';
    if(progress >= 100){
      clearInterval(interval);
      setTimeout(()=>{ processingContainer.style.display='none'; showResult(); }, 700);
    }
  }, 450);
}

function finish(){
  clearInterval(timerInterval);
  // go to processing first, then result
  showProcessingAndResult();
}

function showResult(){
  resultCard.style.display = 'block';
  const pass = score >= minScore;
  if(pass){
    resultCard.innerHTML = `
      <div class="result">
        <div class="badge">Aprovado â€” PrÃ©-Apto</div>
        <h2>ParabÃ©ns!</h2>
        <div class="small">VocÃª acertou <strong>${score}</strong> de <strong>${questions.length}</strong> perguntas</div>
        <div class="score pass">${score}/${questions.length}</div>
        <p>Parece que vocÃª tem conhecimento teÃ³rico e psicotÃ©cnico suficientes. <br>VocÃª foi <b>PRÃ‰-APROVADO(A)</b> â€” Ãºltima etapa: validar identidade.</p>
        <div style="display:flex;gap:10px;justify-content:center;margin-top:18px">
          <button class="btn" id="btnContinue">Continuar</button>
          <button class="btn secondary" id="btnGuide">Guia de Estudos</button>
        </div>
      </div>
    `;
    confettiBurst();
    document.getElementById('btnContinue').onclick = ()=> {
      // Simular aÃ§Ã£o de continuar (pode ser alterado)
      showFinalProtocol(true);
    };
  } else {
    resultCard.innerHTML = `
      <div class="result">
        <div class="badge">NÃ£o Aprovado</div>
        <h2>Ops!</h2>
        <div class="small">VocÃª acertou <strong>${score}</strong> de <strong>${questions.length}</strong> perguntas</div>
        <div class="score fail">${score}/${questions.length}</div>
        <p>VocÃª nÃ£o atingiu a pontuaÃ§Ã£o mÃ­nima. Recomendamos estudar mais e tentar novamente para garantir seguranÃ§a no trÃ¢nsito.</p>
        <div style="display:flex;gap:10px;justify-content:center;margin-top:18px">
          <button class="btn" id="btnRetry">Refazer Quiz</button>
          <button class="btn secondary" id="btnGuideFail">Guia de Estudos</button>
        </div>
      </div>
    `;
    document.getElementById('btnRetry').onclick = ()=> location.reload();
    document.getElementById('btnGuideFail').onclick = ()=> window.open('https://www.gov.br/pt-br/servicos/solicitar-emitir-cnh','_blank');
  }
  document.getElementById('miniProgress').style.width='100%';
}

function showFinalProtocol(passed){
  // Show cinematic final protocol page (keeps GOV look)
  resultCard.innerHTML = `
    <div class="result" style="padding:30px">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Gov.br_logo.svg/512px-Gov.br_logo.svg.png" style="width:140px;margin-bottom:14px">
      <h2 style="margin-top:6px">${passed ? 'PrÃ©-AprovaÃ§Ã£o Confirmada' : 'Resultado'}</h2>
      <p class="small" style="margin-top:8px">${passed ? 'Seu resultado foi encaminhado para validaÃ§Ã£o final pelo sistema GOV.BR.' : 'Sua anÃ¡lise foi concluÃ­da.'}</p>
      <div style="background:#f0f6ff;padding:14px;border-radius:12px;margin:18px 0">
        <p style="margin:6px 0;color:#063970;font-weight:700">Protocolo:</p>
        <p style="margin:0;font-size:18px;color:#063970;border-top:1px solid #e6eefb;padding-top:8px">GOV-${Math.floor(Math.random()*900000+100000)}</p>
      </div>
      <p style="color:#555;margin-bottom:18px">Em atÃ© 48 horas Ãºteis sua solicitaÃ§Ã£o serÃ¡ revisada pela equipe responsÃ¡vel. Fique atento aos canais oficiais GOV.BR.</p>
      <div style="display:flex;gap:10px;justify-content:center">
        <button class="btn" onclick="location.reload()">Finalizar</button>
        <button class="btn secondary" onclick="window.open('https://www.gov.br/pt-br/servicos/solicitar-emitir-cnh','_blank')">Ver orientaÃ§Ãµes</button>
      </div>
    </div>
  `;
}

/* small helpers */
function getIconForQuestion(i){
  const icons = ['ğŸš¦','ğŸ“˜','ğŸš¶','ğŸ·','ğŸªª','âš ï¸','â†”ï¸','ğŸ”’','ğŸŒ§ï¸','ğŸ”','ğŸ”„','ğŸ‘¶','ğŸ›‘','ğŸš‘','ğŸ“œ',
                 'ğŸ˜Œ','ğŸ›‘','ğŸš‘','â†”ï¸','âš ï¸','ğŸ“','ğŸ•’','ğŸŒ§ï¸','ğŸ§','ğŸš“','âš ï¸','ğŸ§˜','ğŸ«','ğŸ“','ğŸ•Šï¸'];
  return icons[i] || 'â“';
}

function confettiBurst(){
  for(let i=0;i<36;i++){
    const el = document.createElement('div');
    el.className='confetti-piece';
    el.style.left = Math.random()*90 + '%';
    el.style.top = '-10%';
    el.style.background = randomColor();
    el.style.transform = `rotate(${Math.random()*360}deg)`;
    document.body.appendChild(el);
    animateConfetti(el);
  }
  setTimeout(()=>{ document.querySelectorAll('.confetti-piece').forEach(n=>n.remove()); },3800);
}

function randomColor(){
  const pool = ['#ffcb05','#ff7a00','#00b894','#2d6cdf','#ff6b6b','#6c5ce7'];
  return pool[Math.floor(Math.random()*pool.length)];
}

function animateConfetti(el){
  const endY = window.innerHeight + 200;
  const sway = (Math.random()*60) - 30;
  el.animate([
    { transform: `translateY(0px) rotate(${Math.random()*360}deg)`, opacity:1 },
    { transform: `translate(${sway}px, ${endY}px) rotate(${Math.random()*720}deg)`, opacity:0.85 }
  ], { duration: 2800 + Math.random()*900, easing:'cubic-bezier(.2,.7,.2,1)' });
  setTimeout(()=>{ try{ el.remove(); }catch(e){} },3600);
}

function init(){
  render();
  document.addEventListener('click', e=>{
    if(e.target.closest('.option')) btnNext.disabled=false;
  });
}
init();
</script>
</body>
</html>
